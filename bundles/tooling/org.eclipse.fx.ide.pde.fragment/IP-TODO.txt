Class is copied from PDE 3.9